@model Sistemas_de_inventario.Models.ViewModels.MaterialCreateViewModel
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Almacén</title>
    <link rel="stylesheet" href="/css/BackGround.css" />
    <link rel="stylesheet" href="/css/Warehouse.css" />
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.min.css" />
</head>
<body>
    <!-- Contenedor del fondo animado -->
    <div id="large-header" class="large-header">
        <canvas id="demo-canvas"></canvas>
    </div>

    <!-- Layout de dos columnas -->
    <div class="page-container">
        <nav class="sidebar">
            <h2>Acciones</h2>
            <ul>
                <li><a href="#" id="buscarBtn">Buscar Material</a></li>
                <li><a href="#" id="agregarBtn">Agregar Material</a></li>
                <li><a href="#" id="moverBtn">Mover Material</a></li>
                <li><a href="#" id="solicitudesBtn">Solicitudes</a></li>
            </ul>
        </nav>

        <!-- Contenido principal (columna derecha) -->
        <main class="main-content">
            <header>
            </header>

            <!-- Sección de Búsqueda -->
            <section id="buscarSection" class="content-section">
                <h2>Buscar Material</h2>
                <div class="search-container">
                    <!-- Form SIN action, para que NO haga submit tradicional -->
                    <form id="search-form" class="mb-4">
                        <div class="input-group">
                            <input type="text"
                                   id="part-number"
                                   name="part-number"
                                   class="form-control"
                                   placeholder="Ingresa el número de parte" />
                            <div class="input-group-append">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search"></i> Buscar
                                </button>
                            </div>
                        </div>
                    </form>

                    <!-- Resultados de Búsqueda -->
                    <div id="resultados-busqueda" style="display: none;">
                        <div class="card material-card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="card-title mb-0">Detalles del Material</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- Columna Izquierda - Datos Básicos -->
                                    <div class="col-md-6">
                                        <div class="info-group">
                                            <span class="info-label">Número de Parte:</span>
                                            <span id="num-parte" class="info-value"></span>
                                        </div>
                                        <div class="info-group">
                                            <span class="info-label">Descripción:</span>
                                            <span id="descripcion" class="info-value"></span>
                                        </div>
                                        <div class="info-group">
                                            <span class="info-label">Categoría:</span>
                                            <span id="categoria" class="info-value"></span>
                                        </div>
                                    </div>

                                    <!-- Columna Derecha - Datos de Inventario -->
                                    <div class="col-md-6">
                                        <div class="info-group">
                                            <span class="info-label">Cantidad Disponible:</span>
                                            <span id="cantidad" class="info-value"></span>
                                        </div>
                                        <div class="info-group">
                                            <span class="info-label">Locacion:</span>
                                            <span id="ubicacion" class="info-value"></span>
                                        </div>
                                        <div class="info-group">
                                            <span class="info-label">Proveedor Principal:</span>
                                            <span id="proveedor" class="info-value"></span>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mensaje cuando no hay resultados -->
                    <div id="sin-resultados" class="alert alert-warning mt-3" style="display: none;">
                        No se encontraron resultados para el número de parte ingresado.
                    </div>
                </div>
            </section>



            <section id="agregarSection" class="content-section">
                <h2 class="mb-4">Agregar Nuevo Material</h2>

                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        @TempData["SuccessMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                @if (!ViewData.ModelState.IsValid)
                {
                    <div class="alert alert-danger">
                        <ul>
                            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                            {
                                <li>@error.ErrorMessage</li>
                            }
                        </ul>
                    </div>
                }

                <!-- NOTA: "method=post" y "asp-action" pueden quedar, pero no se usará el submit normal.
                     El AJAX sobrescribirá el evento "submit".
                     También agregamos un "id" y "action" para que jQuery lo use. -->
                <form id="agregarForm"
                      asp-controller="Materiales"
                      asp-action="Warehouse"
                      method="post">
                    @Html.AntiForgeryToken()

                    <!-- Primera Fila -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label asp-for="NumeroParte"></label>
                                <input asp-for="NumeroParte" class="form-control"
                                       pattern="[A-Z0-9-]+"
                                       title="Solo mayúsculas, números y guiones">
                                <span asp-validation-for="NumeroParte" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label asp-for="Lote"></label>
                                <input asp-for="Lote" class="form-control">
                                <span asp-validation-for="Lote" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Descripción -->
                    <div class="form-group mb-3">
                        <label asp-for="Descripcion"></label>
                        <textarea asp-for="Descripcion" class="form-control" rows="2"></textarea>
                        <span asp-validation-for="Descripcion" class="text-danger"></span>
                    </div>

                    <!-- Ubicación, Proveedor, Cantidad -->
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label asp-for="Ubicacion"></label>
                                <select asp-for="Ubicacion" class="form-control" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="ZONA1-EST1-BIN1">ZONA1-EST1-BIN1</option>
                                    <option value="ZONA1-EST1-BIN2">ZONA1-EST1-BIN2</option>
                                    <!-- Más opciones -->
                                </select>
                                <span asp-validation-for="Ubicacion" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label asp-for="Proveedor"></label>
                                <select asp-for="Proveedor" class="form-control">
                                    <option value="">Sin proveedor</option>
                                    <option value="Proveedor A">Proveedor A</option>
                                    <option value="Proveedor B">Proveedor B</option>
                                </select>
                                <span asp-validation-for="Proveedor" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label asp-for="Cantidad"></label>
                                <input asp-for="Cantidad" class="form-control" min="1" value="1">
                                <span asp-validation-for="Cantidad" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Categoría y Unidad de Medida -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label asp-for="Categoria"></label>
                                <select asp-for="Categoria" class="form-control"
                                        asp-items="Html.GetEnumSelectList<CategoriasMaterial>()">
                                    <option value="">Seleccione categoría...</option>
                                </select>
                                <span asp-validation-for="Categoria" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label asp-for="UnidadMedida"></label>
                                <select asp-for="UnidadMedida" class="form-control"
                                        asp-items="Html.GetEnumSelectList<UnidadesMedida>()">
                                    <option value="">Seleccione unidad...</option>
                                </select>
                                <span asp-validation-for="UnidadMedida" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Botón de envío -->
                    <div class="form-group text-center mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Guardar Material
                        </button>
                    </div>
                </form>
            </section>



            <!-- Sección para Mover Material -->
            <section id="moverSection" class="content-section" style="display: none;">
                <h2 class="mb-4">Mover Material</h2>
                <form id="moverForm">
                    <!-- Selección de Material -->
                    <div class="form-group mb-3">
                        <label for="parte-mover" class="form-label">Número de Parte *</label>
                        <select id="parte-mover" name="parte-mover" class="form-control form-control-sm" required>
                            <option value="">Buscar o seleccionar material...</option>
                            <!-- Opciones se llenarán dinámicamente desde la base de datos -->
                            <option value="PARTE-001">PARTE-001 - Tornillo hexagonal 5mm</option>
                            <option value="PARTE-002">PARTE-002 - Tablero MDF 1/2"</option>
                            <option value="PARTE-003">PARTE-003 - Cable eléctrico 14AWG</option>
                        </select>
                    </div>

                    <!-- Selección de Lote/Serie -->
                    <div class="form-group mb-3">
                        <label for="lote-mover" class="form-label">Lote/Serie *</label>
                        <select id="lote-mover" name="lote-mover" class="form-control form-control-sm" required>
                            <option value="">Seleccionar lote...</option>
                            <!-- Opciones se actualizarán según el material seleccionado en la base de datos  -->
                            <option value="LOTE-2023-001">LOTE-2023-001 (Q: 150)</option>
                            <option value="LOTE-2023-002">LOTE-2023-002 (Q: 75)</option>
                        </select>
                    </div>

                    <!-- Ubicación Actual -->
                    <div class="form-group mb-3">
                        <label class="form-label">Ubicación Actual</label>
                        <input type="text" id="ubicacion-actual" class="form-control form-control-sm" readonly>
                    </div>

                    <!-- Selección de Nueva Ubicación -->
                    <div class="form-group mb-3">
                        <label for="nueva-ubicacion" class="form-label">Nueva Ubicación *</label>
                        <select id="nueva-ubicacion" name="nueva-ubicacion" class="form-control form-control-sm" required>
                            <option value="">Seleccionar destino...</option>
                            <option value="ZONA1-EST1-BIN1">ZONA1-EST1-BIN1</option>
                            <option value="ZONA1-EST1-BIN2">ZONA1-EST1-BIN2</option>
                            <option value="ZONA1-EST2-BIN1">ZONA1-EST2-BIN1</option>
                            <option value="ZONA1-EST2-BIN2">ZONA1-EST2-BIN2</option>
                            <option value="ZONA2-EST1-BIN1">ZONA2-EST1-BIN1</option>
                            <option value="ZONA2-EST1-BIN2">ZONA2-EST1-BIN2</option>
                        </select>
                        <small class="form-text text-muted">Formato: ZONA-ESTANTE-BIN</small>
                    </div>

                    <!-- Cantidad a Mover -->
                    <div class="form-group mb-3">
                        <label for="cantidad-mover" class="form-label">Cantidad a Mover *</label>
                        <input type="number" id="cantidad-mover" name="cantidad-mover" class="form-control form-control-sm" min="1" value="1" required>
                        <small id="cantidad-disponible" class="form-text text-muted"></small>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="form-group text-right mt-4">
                        <button type="button" class="btn btn-secondary btn-sm mr-2">Cancelar</button>
                        <button type="submit" class="btn btn-primary btn-sm">
                            <i class="fas fa-exchange-alt"></i> Mover Material
                        </button>
                    </div>
                </form>
            </section>

            <!-- Sección para Solicitudes Recibidas -->
            <section id="solicitudesSection" class="content-section" style="display: none;">
                <h2>Solicitudes Recibidas de Producción</h2>

                <!-- Filtros para las solicitudes -->
                <div class="filtros-solicitudes mb-4">
                    <div class="row">
                        <div class="col-md-4">
                            <label for="filtro-estado">Filtrar por estado:</label>
                            <select id="filtro-estado" class="form-control">
                                <option value="todas">Todas</option>
                                <option value="pendiente">Pendientes</option>
                                <option value="proceso">En proceso</option>
                                <option value="completada">Completadas</option>
                                <option value="rechazada">Rechazadas</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="filtro-fecha">Filtrar por fecha:</label>
                            <input type="date" id="filtro-fecha" class="form-control">
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button id="aplicar-filtros" class="btn btn-primary">Aplicar Filtros</button>
                        </div>
                    </div>
                </div>

                <!-- Tabla de solicitudes -->
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="thead-dark">
                            <tr>
                                <th>ID</th>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Material</th>
                                <th>Cantidad</th>
                                <th>Solicitante</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ejemplo de fila - esto se llenaría dinámicamente con datos reales del sql  -->
                            <tr>
                                <td>SOL-001</td>
                                <td>2025-04-10</td>
                                <td>Pedido</td>
                                <td>Tornillos 5mm</td>
                                <td>100</td>
                                <td>Producción Línea A</td>
                                <td><span class="badge badge-warning">Pendiente</span></td>
                                <td>
                                    <button class="btn btn-sm btn-success">Aprobar</button>
                                    <button class="btn btn-sm btn-danger">Rechazar</button>
                                </td>
                            </tr>
                            <tr>
                                <td>SOL-002</td>
                                <td>2025-04-09</td>
                                <td>Traslado</td>
                                <td>Tableros MDF</td>
                                <td>20</td>
                                <td>Producción Línea B</td>
                                <td><span class="badge badge-success">Completada</span></td>
                                <td>
                                    <button class="btn btn-sm btn-info" disabled>Ver Detalle</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Paginación -->
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Anterior</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">Siguiente</a>
                        </li>
                    </ul>
                </nav>
            </section>
        </main>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 - Sistema de Inventario - Almacén</p>
        </div>
    </footer>

    <!-- GSAP (para TweenLite) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenLite.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/easing/EasePack.min.js"></script>
    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/BackGround.js"></script>
    <script src="/js/Warehouse.js"></script>
    <script src="/js/materialesAjax.js"></script>
</body>
</html>